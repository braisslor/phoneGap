<!DOCTYPE html>
<html><head> 
	<meta content="yes" name="apple-mobile-web-app-capable" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name = 'viewport' content = 'user-scalable=no,width=device-width,minimum-scale=1.0,maximum-scale=0.6667'/>
	<link href="css/jquery-ui.css" type ="text/css" rel="stylesheet" />
	<link href="css/prettyPhone.css" type ="text/css" rel="stylesheet" />
	<link rel="apple-touch-icon" href="apple-touch-icon-precomposed.png"/>
	<script src='js/jquery.min.js'></script>
	<script src='js/jquery-ui.min.js'></script>
	<script id='ip_id' type='text/javascript' src="http://www.codehelper.io/api/ips/?js"></script>
	<style> 
		#slider { 
			margin: 20px;
		} 
		.slider_wrapper {
			background: #000;
		}
	</style>
	<script>
		var roVar = 2;
		var outVar = 2;
		var WANIP='107.223.141.134';
		var LANIP='192.168.10.201';
		var lastIp = "";
		var ipText="";
		function changeLight(event, ui) { 
			document.getElementById('t').innerHTML='<center>Sending';
			setTimeout(function(){document.getElementById('t').innerHTML='<center>Control the Fan!'},450);
			$.post(ipText, { ro: roVar, li: ui.value } );
			updateIPText(); 
		}
		$(document).ready(
			function(){ 
				 
				roVar = 2; //This is for living room at my house currently. Not permanent
				$('#slider').slider({min: 1, max:19, value:10, change:changeLight}); 
				updateIPText();
				}
		);

		function updateIPText(butVal) {
			$('#ip_id').remove();
			var script = document.createElement('script');
			script.id = 'ip_id';
			script.src = 'http://www.codehelper.io/api/ips/?js';
			script.type = 'text/javascript';
			document.getElementsByTagName('head')[0].appendChild(script);
			//document.getElementById('n').innerHTML=codehelper_ip.IP;
			//If my current IP and the WANIP are the same then i'm on the same network as the uController
			if (codehelper_ip.IP == WANIP) {
				lastIp = codehelper_ip.IP;
				ipText = 'http://' + LANIP + '/';
				document.getElementById('d').innerHTML="On Home WIFI";
			} else {
				lastIp = codehelper_ip.IP;
				ipText = 'http://' + WANIP + ':245/';
				document.getElementById('d').innerHTML="Not on Home WIFI";
			}
				//document.getElementById('n').innerHTML="Waiting";
			setTimeout(
				function () { 
					if (lastIp != codehelper_ip.IP) { 
						if (codehelper_ip.IP == WANIP) {
						lastIp = codehelper_ip.IP;
						ipText = 'http://' + LANIP + '/';
						document.getElementById('d').innerHTML="On Home WIFI";
					} else {
					lastIp = codehelper_ip.IP;
					ipText = 'http://' + WANIP + ':245/';
					document.getElementById('d').innerHTML="Not on Home WIFI";
					$.post(ipText, { ro: roVar, li: butVal} );
					}
					//document.getElementById('n').innerHTML="Resending";
					
					}
					}, 750);
			
		}	
		function changeOutlet(outNum) { 
			outVar = outNum;
		}
		function sendOutlet(incVal) {
			document.getElementById('title').innerHTML='<center>Sending';
			updateIPText(incVal);
			setTimeout(function(){document.getElementById('title').innerHTML='<center>Control the Fan!'},450);
			$.post(ipText + 'outlet' ,  {ou: outVar} ); 
		}
			
		function butPressed(butVal) {
			document.getElementById('title').innerHTML='<center>Sending';
			updateIPText(butVal);
			setTimeout(function(){document.getElementById('title').innerHTML='<center>Control the Fan!'},450);
			$.post(ipText, { ro: roVar, li: butVal} );
		}
		function changeRoom(roNum) { 
			roVar = roNum;
		}	
	</script>
</head>
<body>
	<div id="topbar">
		<div id="title">Control the Fan!</div>
	</div>
	<div id="content">
		<center>
		<form>
		<fieldset>
		<legend><center>Room</center></legend>
		<p>           
          <input type = "radio"
                 name = "room"
                 id = "roomBed"
                 onchange = changeRoom(1);
                  />
          <label>Bed Room</label>
          
          <input type = "radio"
                 name = "room"
                 id = "roomLiving"
                 checked = "checked"
                 onchange = changeRoom(2);
                 />
          <label>Living Room</label>
        </p>       
		</fieldset>     
		</form>
		<button onclick='butPressed(21)'>LIGHT</button>
		<div id="slider" value=10></div>
		<h1>Fan:</h1>
		<button onclick='butPressed(22)'>OFF</button>
		<button onclick='butPressed(23)'>LOW</button>
		<button onclick='butPressed(24)'>MED</button>
		<button onclick='butPressed(25)'>HIGH</button><br>
		<p id='d'></p>
		<p id ='n'></p></center>
	</div>
	<br><br>
	<div id="content">
		<center>
		<form>
		<fieldset>
		<legend><center>Outlets</center></legend>
		<p>           
          <input type = "radio"
                 name = "outlet"
                 id = "outTrees"
                 onchange = changeOutlet(1);
                  />
          <label>Trees</label>
          
          <input type = "radio"
                 name = "outlet"
                 id = "fanOutlet"
                 checked = "checked"
                 onchange = changeOutlet(2);
                 />
          <label>Fan</label>
          <input type = "radio"
                 name = "outlet"
                 id = "houseOutlet"
                 onchange = changeOutlet(4);
                 />
          <label>House Lights</label>
        </p>       
		</fieldset>     
		</form>
		<button onclick='sendOutlet(1)'>Send Outlet</button><br>
	</div>
</body></html>